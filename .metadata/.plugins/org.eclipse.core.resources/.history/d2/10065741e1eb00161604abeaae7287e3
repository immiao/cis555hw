package edu.upenn.cis455.webserver;

import java.net.*;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;

import edu.upenn.cis455.webserver.utils.*;
import java.io.*;
public class HttpServer {
  static private boolean isShutDown = false;
  static ThreadPool threadPool = new ThreadPool(4, 100);
  static ServerSocket serverSocket;
  public static void main(String args[]){
    
    String rootDir;
    
    if (args.length == 0) {
    	System.out.println("***Author: Kaixiang Miao (miaok)");
    	serverSocket = new ServerSocket(8080);
    	rootDir = new String("/");
    }
    else {
    	serverSocket = new ServerSocket(Integer.parseInt(args[0]));
    	if (args.length == 1)
    		rootDir = new String("/");
    	else
    		rootDir = args[1];
    }
    try {
    while (!isShutDown) {
    	Socket socket = serverSocket.accept();

    	//socket.
    	if (socket == null) System.out.println("NULL");
    	HttpResponseRunnable task = new HttpResponseRunnable(socket, rootDir);
    	
    	threadPool.execute(task);
    }
    }
    
  }
  
  public static void shutdown() {
	  
	  threadPool.shutdown();
	  isShutDown = true;
	  try {
		serverSocket.close();
	} catch (IOException e) {
		// TODO Auto-generated catch block
		e.printStackTrace();
	}
  }
  
}
